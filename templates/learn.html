<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Изучение слов</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/learn.css') }}">
    <style>
        .logout-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 0.8em;
            background-color: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
        }
        .logout-button:hover {
            background-color: #e9ecef;
        }
        
        /* Скрытые элементы для JS */
        #loading, #small-loading, #error-message {
            display: none;
        }
    </style>
    <script src="{{ url_for('static', filename='js/learn-session.js') }}"></script>
</head>
<body>
    <a href="{{ url_for('logout') }}" class="logout-button">Выйти</a>
    
    <!-- Индикатор загрузки (скрыт) -->
    <div id="loading">Загрузка слов...</div>
    
    <!-- Сообщение об ошибке (скрыто) -->
    <div id="error-message"></div>
    
    <div id="learning-container">
        <h2>Выберите перевод слова: <em id="word-text">{{ word.text|safe }}</em></h2>
        <p id="progress" class="progress">{{ ui_elements.word_progress.format(current_word, total_words) }}</p>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <p class="flash" style="color: #e74c3c;">{{ message }}</p>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form id="answer-form" method="post" action="/learn">
            <div id="options-container">
                {% for opt in options %}
                    <label class="{% if result is not none %}{% if opt == result.correct_translation %}correct{% elif opt == selected_answer and opt != result.correct_translation %}wrong{% endif %}{% endif %}">
                        <input type="radio" name="answer" value="{{ opt }}" required
                            {% if result is not none %}disabled{% endif %}
                            {% if selected_answer == opt %}checked{% endif %} />
                        <span>{{ opt }}</span>
                    </label>
                {% endfor %}
            </div>
            
            <!-- Скрытые поля для JS -->
            <input type="hidden" id="word-id" name="word_id" value="{{ word.id }}" />
            <input type="hidden" id="correct-translation" name="correct_translation" value="{{ word.correct_translation }}" />
            
            <button type="submit" id="answer-button" {% if result is not none %}disabled{% endif %}>{{ ui_elements.answer_button }}</button>
            <span id="small-loading" style="display:none;">⏳</span>
        </form>
        
        <div id="result-container" class="result-container {% if result is not none %}{{ 'correct' if result.correct else 'wrong' }}{% endif %}">
            {% if result is not none %}
                {% if result.correct %}
                    {{ success_messages.correct_answer }}
                {% else %}
                    {{ result_messages.wrong_answer.format(result.correct_translation) }}
                {% endif %}
                <form method="get" action="/learn" style="margin-top: 20px;">
                    <button id="next-button" type="submit">{{ ui_elements.next_button }}</button>
                </form>
            {% endif %}
        </div>
    </div>
</body>
</html>
